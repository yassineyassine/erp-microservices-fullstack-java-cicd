# JHipster generated helm package manager
jhipster kubernetes-helm | k8s-helm
## Preparation

Exécuter cette commande dans chaque micro service
./mvnw -ntp -Pprod compile jib:dockerBuild
You will need to push your image to a registry. If you have not done so, use the following commands to tag and push the images:

```
$ docker image tag invoice store/invoice
$ docker image store/invoice
$ docker image tag notification store/notification
$ docker image store/notification
$ docker image tag product store/product
$ docker image store/product
$ docker image tag store store/store
$ docker image store/store
```

## Prerequisites

To use the templates generated by this sub-generator `helm cli and tiller` should be installed. Instructions on installing `helm` can be referred
at [https://github.com/helm/helm](https://github.com/helm/helm)

Once Helm is installed you need to add the below repositories:

```
helm repo add stable https://charts.helm.sh/stable
helm repo add incubator https://charts.helm.sh/incubator
```

These repositories should be added to the local cache, because this sub-generator will pull some charts from them.

This repository in turn uses the `kubernetes` sub-generator for the microservices manifests and few service like database, Elasticsearch, Prometheus etc. that are referred from the above repositories.

## Deployment

You can deploy all your applications by running the following bash command:

```
bash helm-apply.sh (or) ./helm-apply.sh
```

`helm-apply.sh` will always do a clean install. Any of the existing charts with the same identity gets removed first and then it does a clean install.

You can upgrade all your apps (if you have made any changes to the generated manifests) by running the following bash command:

```
bash helm-upgrade.sh (or) ./helm-upgrade.sh
```

For Kubernetes specific information, refer to the `kubernetes` sub-generator Readme instructions.

### Backlogs to be covered

- helm upgrade - to be tested
- Istio - to be tested

##Kubernestes secret pour accéder à un repo nexus
kubectl create secret docker-registry nexus-secret \
  --docker-server=192.168.24.65:5003 \
  --docker-username=ton_user \
  --docker-password=ton_password \
  --docker-email=ton_email@example.com \
  -n erp1
Ajouter secret dans le fichier de deploymement

spec:
  template:
    spec:
      imagePullSecrets:
        - name: nexus-secret
##K3S probléme accé repo nexus https
/etc/rancher/k3s/registries.yaml

mirrors:
  "192.168.1.22:5003":
    endpoint:
      - "http://192.168.1.22:5003"

sudo systemctl restart k3s


##Ingress treafik
packager default k3s utilise treafik
Configurer hosts machine wsl2
127.0.0.1 store.erp.127.0.0.1.nip.io
